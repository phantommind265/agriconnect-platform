<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Farmer Dashboard - AgriConnect</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <link rel="icon" href="{{ url_for('static', filename='images/icon.png') }}">

  <style>
    :root {
      --ag-primary: #16a34a;
      --ag-primary-600: #16a34a;
      --ag-primary-700: #15803d;
      --ag-bg: #064e3b;
      --ag-card: rgba(255,255,255,.05);
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--ag-bg);
      color: #e5e7eb;
    }
    a { text-decoration: none; }

    /* Navbar */
    .navbar { background: rgba(2,6,23,.6) !important; }
    .navbar-brand, .nav-link { color: #e5e7eb !important; }
    .toggle-btn { background: var(--ag-primary); color: #fff; border:none; padding:8px 12px; border-radius:6px;}

    /* Sidebar */
    .sidebar {
      position: fixed; top: 0; left: 0; width: 220px; height: 100vh;
      background: #0b1220; color: #e5e7eb; overflow-y: auto; z-index: 100;
    }
    .sidebar a {
      display: block; color: #d1d5db; padding: 10px 12px;
      border-radius: 8px; transition: background 0.2s, color 0.2s;
    }
    .sidebar a:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .dropdown-content {
      display: none; position: absolute; top: 40px; left: 0;
      background: #1b2735; min-width: 200px; border-radius: 8px;
      overflow: hidden; z-index: 105;
    }
    .dropdown-content a { color: #e5e7eb; background: #1b2735; padding:12px 16px; }
    .dropdown-content a:hover { background:#16a34a; color:#fff; }
    .dropdown:hover .dropdown-content { display:block; }

    .content { margin-left: 220px; padding: 20px; transition: margin-left 0.3s ease-in-out; }

    /* Cards */
    .card {
      border-radius: 16px;
      background: var(--ag-card);
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      transition: transform 0.2s;
    }
    .hover-scale:hover { transform: scale(1.05); cursor: pointer; }

    /* Footer */
    .footer {
      background: var(--ag-bg);
      color: #e5e7eb;
      padding: 50px 20px 20px;
      font-family: 'Inter', sans-serif;
    }
    .footer a { color: #e5e7eb; text-decoration:none; transition: color 0.3s; }
    .footer a:hover { color: #facc15; }
    .footer-bottom { border-top:1px solid rgba(255,255,255,.1); padding-top:15px; text-align:center; color:#9ca3af; }

    /* Modal */
    .modal-content { background: var(--ag-card); color: #e5e7eb; }
    .modal-header { background: var(--ag-primary); color:#fff; }

    /* Responsive */
    @media (max-width: 991px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.active { transform: translateX(0); }
      .content { margin-left: 0; }
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container-fluid">
    <button class="toggle-btn d-lg-none me-2" id="menuToggle"><i class="fas fa-bars"></i></button>
    <a class="navbar-brand" href="#">agriconnect</a>
    <div class="ms-auto">
      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#aiAssistant">
        ü§ñ Ask AI
      </button>
    </div>
  </div>
</nav>

<!-- Sidebar -->
<div class="sidebar" id="sidebarMenu">
  <h5 class="text-light text-center mb-3">üë®‚Äçüåæ Farmer</h5>
  <a href="{{ url_for('farmer.view_profile') }}"><i class="fa-solid fa-user"></i> Profile</a>

  <div class="dropdown">
    <a href="#"><i class="fa-solid fa-seedling me-2"></i>My Fields & Crops</a>
    <div class="dropdown-content">
      <a href="{{ url_for('field.my_fields') }}">Add Field</a>
      <a href="{{ url_for('field.my_crops') }}">Add Crop</a>
      <a href="{{ url_for('field.view_fields') }}">View Fields</a>
      <a href="{{ url_for('field.active_crops') }}">View Crops</a>
    </div>
  </div>

  <a href="{{ url_for('farmer_advisory.dashboard') }}"><i class="fa-solid fa-lightbulb me-2"></i> Advisory</a>
  <a href="{{ url_for('message_bp.users_list') }}"><i class="fa-solid fa-message me-2"></i> Messaging</a>
  <a href="{{ url_for('reports.my_reports') }}"><i class="fa-solid fa-file-lines me-2"></i> Reports</a>
  <a href="{{ url_for('reports.export_pdf') }}"><i class="fa-solid fa-download"></i> Download PDF</a>

  <div class="dropdown">
    <a href="#"><i class="fa-solid fa-handshake-angle"></i> Agrishare</a>
    <div class="dropdown-content">
      <a href="{{ url_for('agrishare.create_share_session') }}">Share</a>
      <a href="{{ url_for('agrishare.join_session') }}">Receive</a>
    </div>
  </div>

  <a href="{{ url_for('knowledge_bp.view_knowledge') }}"><i class="fa-solid fa-book me-2"></i> Knowledge Hub</a>
  <a href="{{ url_for('farmer.all_farmers') }}"><i class="fa-solid fa-people-group"></i> Farmer Directory</a>

  <div class="dropdown">
    <a href="#"><i class="fa-solid fa-chart-line me-2"></i> Market</a>
    <div class="dropdown-content">
      <a href="{{ url_for('market.market_prices') }}">Market Prices</a>
      <a href="{{ url_for('market.estimate_profit') }}">Estimate Profit</a>
      <a href="{{ url_for('marketplace.market_page') }}">Marketplace</a>
    </div>
  </div>

  <a href="{{ url_for('ai.ai_assistant') }}"><i class="fa-solid fa-robot"></i> Agriconnect AI</a>
  <a href="{{ url_for('weather.weather_page') }}"><i class="fa-solid fa-cloud"></i> Weather Update</a>
  <a href="{{ url_for('forum.forum_home') }}"><i class="fa-solid fa-people-group"></i> Forum Discussion</a>

  <div class="dropdown">
    <a href="#"><i class="fa-solid fa-calendar"></i> Events</a>
    <div class="dropdown-content">
      <a href="{{ url_for('events_bp.view_events') }}">View Events</a>
      <a href="{{ url_for('events_bp.add_event') }}">Add Event</a>
      <a href="{{ url_for('events_bp.my_events') }}">My Events</a>
    </div>
  </div>

  <a href="{{ url_for('transport.new_transport') }}"><i class="fa-solid fa-car"></i> Post Transport</a>
  <a href="{{ url_for('warehouse.add_warehouse') }}">Warehouse</a>
  <a href="{{ url_for('crop.crop_list') }}"><i class="fa-solid fa-seedling"></i> Crops</a>
  <a href="{{ url_for('pest.list_pests') }}"><i class="fa-solid fa-bug"></i> Pest & Diseases</a>

  <a href="{{ url_for('auth.logout') }}"><i class="fa-solid fa-sign-out-alt"></i> Logout</a>
</div>

<!-- Content -->
<div class="content">
  <div class="container-fluid mt-4 pt-3">
    <h2 class="fw-bold text-success mb-4">üëã Welcome back, {{ current_user.username }}!</h2>

    <div class="row g-3">
      <div class="col-6 col-lg-3">
        <div class="card hover-scale p-3 text-center h-100">
          <i class="fa-solid fa-car fa-2x text-success mb-2"></i>
          <h5><a href="{{ url_for('transport.list_transport') }}" class="text-white">Transport</a></h5>
          <p class="small text-muted">Affordable transport for your goods.</p>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card hover-scale p-3 text-center h-100">
          <i class="fa-solid fa-tractor fa-2x text-success mb-2"></i>
          <h5><a href="{{ url_for('equipment.marketplace') }}" class="text-white">Equipment</a></h5>
          <p class="small text-muted">Access farm equipment anywhere.</p>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card hover-scale p-3 text-center h-100">
          <i class="fa-solid fa-handshake fa-2x text-success mb-2"></i>
          <h5><a href="{{ url_for('linkage.view_market') }}" class="text-white">Market Linkages</a></h5>
          <p class="small text-muted">Connecting farmers to buyers.</p>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card hover-scale p-3 text-center h-100">
          <i class="fa-solid fa-crosshairs fa-2x text-success mb-2"></i>
          <h5><a href="{{ url_for('services.all_services') }}" class="text-white">Near Services</a></h5>
          <p class="small text-muted">Farming support nearby.</p>
        </div>
      </div>
    </div>

    <!-- Price Trends Chart -->
    <div class="card mt-5 p-3">
      <div class="card-header bg-success text-white">üìä Latest Market Price Trends</div>
      <div class="card-body">
        <canvas id="priceTrendChart" height="200"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- AI Assistant Modal -->
<div class="modal fade" id="aiAssistant" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ü§ñ Agri AI Assistant</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <textarea class="form-control mb-3" placeholder="Ask for advice..."></textarea>
        <button class="btn btn-success w-100">Send</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer mt-5">
  <div class="footer-container">
    <div class="footer-col">
      <h2 class="footer-logo">agriconnect</h2>
      <p>Connecting farmers, extension workers & markets in Malawi with technology, knowledge, and opportunities.</p>
    </div>
    <div class="footer-col">
      <h3>Quick Links</h3>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/features">Features</a></li>
        <li><a href="/forums">Discussion Forums</a></li>
        <li><a href="/profiles">Farmers Profiles</a></li>
        <li><a href="/contact">Contact Us</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h3>Resources</h3>
      <ul>
        <li><a href="/knowledge">Knowledge Hub</a></li>
        <li><a href="/market">Market Prices</a></li>
        <li><a href="/weather">Weather Updates</a></li>
        <li><a href="/support">Support</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h3>Stay Connected</h3>
      <form class="newsletter">
        <input type="email" placeholder="Enter your email" required>
        <button type="submit">Subscribe</button>
      </form>
      <div class="social-icons mt-2">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
        <a href="#"><i class="fab fa-linkedin-in"></i></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom mt-4">
    ¬© <span id="year"></span> AgriConnect. All Rights Reserved.
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.getElementById('menuToggle').addEventListener('click', () => {
    document.getElementById('sidebarMenu').classList.toggle('active');
  });

  // Sample Market Price Trend Chart
  const ctx = document.getElementById('priceTrendChart');
  if (ctx) {
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat'],
        datasets: [{
          label: 'Maize (MWK/kg)',
          data: [300, 320, 315, 330, 340, 345],
          borderColor: '#16a34a',
          backgroundColor: 'rgba(22,163,74,0.2)',
          tension: 0.3,
          fill: true,
          pointRadius: 4,
          pointBackgroundColor: '#16a34a'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: '#e5e7eb' } }
        },
        scales: {
          x: { ticks: { color: '#e5e7eb' }, grid: { color: 'rgba(255,255,255,0.1)' } },
          y: { ticks: { color: '#e5e7eb' }, grid: { color: 'rgba(255,255,255,0.1)' }, beginAtZero: false }
        }
      }
    });
  }
</script>

<!-- FontAwesome for icons -->
<script src="https://kit.fontawesome.com/a2e0e6ad65.js" crossorigin="anonymous"></script>
</body>
</html>
